#!/bin/bash

# ðŸŽ¨ Ø³ÙƒØ±ÙŠØ¨Øª ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¹ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø®ØµÙŠØ©
# ÙŠØ´ØºÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ù…ÙŠØ²Ø§Øª Ø§Ù„ØªØ®ØµÙŠØµ Ø§Ù„Ø´Ø®ØµÙŠ

echo "ðŸŽ¨ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¹ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø®ØµÙŠØ©"
echo "=================================================="

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
echo "ðŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª..."

if ! command -v node &> /dev/null; then
    echo "âŒ Node.js ØºÙŠØ± Ù…ÙÙ†ØµØ¨. ÙŠØ±Ø¬Ù‰ ØªÙ†ØµÙŠØ¨ Node.js Ø£ÙˆÙ„Ø§Ù‹"
    exit 1
fi

if ! command -v python3 &> /dev/null && ! command -v python &> /dev/null; then
    echo "âŒ Python ØºÙŠØ± Ù…ÙÙ†ØµØ¨. ÙŠØ±Ø¬Ù‰ ØªÙ†ØµÙŠØ¨ Python Ø£ÙˆÙ„Ø§Ù‹"
    exit 1
fi

# ØªØ­Ø¯ÙŠØ¯ Ø£Ù…Ø± Python
PYTHON_CMD="python3"
if ! command -v python3 &> /dev/null; then
    PYTHON_CMD="python"
fi

echo "âœ… Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…ØªÙˆÙØ±Ø©"

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©
echo "ðŸ“¦ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©..."

if [ ! -d "node_modules" ]; then
    echo "ðŸ“¥ ØªÙ†ØµÙŠØ¨ packages Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©..."
    npm install
    if [ $? -ne 0 ]; then
        echo "âŒ ÙØ´Ù„ ÙÙŠ ØªÙ†ØµÙŠØ¨ packages Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©"
        exit 1
    fi
fi

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ recharts (Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©)
if ! npm list recharts &> /dev/null; then
    echo "ðŸ“Š ØªÙ†ØµÙŠØ¨ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©..."
    npm install recharts @radix-ui/react-slider
    if [ $? -ne 0 ]; then
        echo "âŒ ÙØ´Ù„ ÙÙŠ ØªÙ†ØµÙŠØ¨ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©"
        exit 1
    fi
fi

echo "âœ… Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ø¬Ø§Ù‡Ø²Ø©"

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ©
echo "ðŸ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ØªØ·Ù„Ø¨Ø§Øª Python..."

if [ -f "backend/requirements.txt" ]; then
    cd backend
    
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
    if ! $PYTHON_CMD -c "import flask, flask_cors, sqlite3" &> /dev/null; then
        echo "ðŸ“¥ ØªÙ†ØµÙŠØ¨ Ù…ØªØ·Ù„Ø¨Ø§Øª Python..."
        $PYTHON_CMD -m pip install -r requirements.txt
        if [ $? -ne 0 ]; then
            echo "âŒ ÙØ´Ù„ ÙÙŠ ØªÙ†ØµÙŠØ¨ Ù…ØªØ·Ù„Ø¨Ø§Øª Python"
            exit 1
        fi
    fi
    
    cd ..
fi

echo "âœ… Ù…ØªØ·Ù„Ø¨Ø§Øª Python Ø¬Ø§Ù‡Ø²Ø©"

# Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª PID
PID_DIR=".pids"
mkdir -p $PID_DIR
BACKEND_PID_FILE="$PID_DIR/backend.pid"
FRONTEND_PID_FILE="$PID_DIR/frontend.pid"

# Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¸ÙŠÙ
cleanup() {
    echo ""
    echo "ðŸ›‘ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø¸Ø§Ù…..."
    
    if [ -f "$BACKEND_PID_FILE" ]; then
        BACKEND_PID=$(cat "$BACKEND_PID_FILE")
        if ps -p $BACKEND_PID > /dev/null 2>&1; then
            echo "ðŸ”¥ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ (PID: $BACKEND_PID)"
            kill $BACKEND_PID 2>/dev/null
        fi
        rm -f "$BACKEND_PID_FILE"
    fi
    
    if [ -f "$FRONTEND_PID_FILE" ]; then
        FRONTEND_PID=$(cat "$FRONTEND_PID_FILE")
        if ps -p $FRONTEND_PID > /dev/null 2>&1; then
            echo "ðŸ”¥ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© (PID: $FRONTEND_PID)"
            kill $FRONTEND_PID 2>/dev/null
        fi
        rm -f "$FRONTEND_PID_FILE"
    fi
    
    rm -rf $PID_DIR 2>/dev/null
    echo "âœ… ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­"
    exit 0
}

# ØªØ³Ø¬ÙŠÙ„ Ø¯Ø§Ù„Ø© cleanup
trap cleanup SIGINT SIGTERM

# Ø¨Ø¯Ø¡ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ
echo "ðŸ”§ Ø¨Ø¯Ø¡ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ Ù…Ø¹ APIs Ø§Ù„ØªØ®ØµÙŠØµ Ø§Ù„Ø´Ø®ØµÙŠ..."
cd backend

# ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
$PYTHON_CMD app.py > ../logs/backend.log 2>&1 &
BACKEND_PID=$!
echo $BACKEND_PID > "../$BACKEND_PID_FILE"

cd ..

# Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
mkdir -p logs

# Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ
echo "â³ Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ..."
sleep 4

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ
if ps -p $BACKEND_PID > /dev/null 2>&1; then
    echo "âœ… Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ http://localhost:5000"
else
    echo "âŒ ÙØ´Ù„ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ"
    echo "ðŸ“‹ Ø¢Ø®Ø± Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£:"
    tail -10 logs/backend.log 2>/dev/null || echo "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù…ØªØ§Ø­Ø©"
    exit 1
fi

# Ø§Ø®ØªØ¨Ø§Ø± APIs Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø®ØµÙŠØ©
echo "ðŸ§ª Ø§Ø®ØªØ¨Ø§Ø± APIs Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø®ØµÙŠØ©..."
if curl -s http://localhost:5000/api/health > /dev/null; then
    echo "âœ… Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ³ØªØ¬ÙŠØ¨ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­"
    
    # Ø§Ø®ØªØ¨Ø§Ø± API Ø§Ù„ØªØ®ØµÙŠØµ Ø§Ù„Ø´Ø®ØµÙŠ
    if curl -s http://localhost:5000/api/style/profile > /dev/null; then
        echo "âœ… APIs Ø§Ù„ØªØ®ØµÙŠØµ Ø§Ù„Ø´Ø®ØµÙŠ Ù…ØªØ§Ø­Ø©"
    else
        echo "âš ï¸  APIs Ø§Ù„ØªØ®ØµÙŠØµ Ø§Ù„Ø´Ø®ØµÙŠ ØºÙŠØ± Ù…ØªØ§Ø­Ø© - Ø³ÙŠØªÙ… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©"
    fi
else
    echo "âš ï¸  Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ø§ ÙŠØ³ØªØ¬ÙŠØ¨ - Ø³ÙŠØªÙ… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©"
fi

# Ø¨Ø¯Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©
echo "ðŸŽ¨ Ø¨Ø¯Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ù…Ø¹ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø®ØµÙŠØ©..."

# ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
npm run dev > logs/frontend.log 2>&1 &
FRONTEND_PID=$!
echo $FRONTEND_PID > "$FRONTEND_PID_FILE"

# Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©
echo "â³ Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©..."
sleep 6

# Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©
if ps -p $FRONTEND_PID > /dev/null 2>&1; then
    echo "âœ… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ http://localhost:5173"
else
    echo "âŒ ÙØ´Ù„ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©"
    echo "ðŸ“‹ Ø¢Ø®Ø± Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£:"
    tail -10 logs/frontend.log 2>/dev/null || echo "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù…ØªØ§Ø­Ø©"
    cleanup
    exit 1
fi

echo ""
echo "ðŸŽ‰ ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¹ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø®ØµÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!"
echo "=================================================="
echo "ðŸŒ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…ØªØ§Ø­Ø©:"
echo "   ðŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©: http://localhost:5173"
echo "   ðŸŽ¨ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø®ØµÙŠØ©: http://localhost:5173/personal-style"
echo "   ðŸŒŸ Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©: http://localhost:5173/unified-journey"
echo "   ðŸ§  Ø±Ø­Ù„Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø°ÙƒÙŠØ©: http://localhost:5173/ai-journey"
echo "   âš™ï¸  Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„ÙÙ†ÙŠ: http://localhost:5173/workflow-builder"
echo "   ðŸ¤– Ø§Ø³ØªÙˆØ¯ÙŠÙˆ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡: http://localhost:5173/agent-studio"
echo ""
echo "ðŸ”§ Ø§Ù„Ø®ÙˆØ§Ø¯Ù…:"
echo "   ðŸ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ: http://localhost:5000"
echo "   âš›ï¸  Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©: http://localhost:5173"
echo ""
echo "ðŸ“ Ù…Ù„ÙØ§Øª Ø§Ù„Ø³Ø¬Ù„Ø§Øª:"
echo "   ðŸ“„ Ø§Ù„Ø®Ù„ÙÙŠØ©: $(pwd)/logs/backend.log"
echo "   ðŸ“„ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©: $(pwd)/logs/frontend.log"
echo ""
echo "ðŸŽ¨ Ù…ÙŠØ²Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø®ØµÙŠØ©:"
echo "   â€¢ ØªØ®ØµÙŠØµ Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ø¬Ø·Ù„Ø§ÙˆÙŠ (ÙƒØ«Ø§ÙØ© Ø§Ù„ÙˆØµÙØŒ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„ÙÙ„Ø³ÙÙŠ)"
echo "   â€¢ Ø¶Ø¨Ø· Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ÙŠØ© (Ø§Ù„Ù…ÙØ±Ø¯Ø§ØªØŒ Ø·ÙˆÙ„ Ø§Ù„Ø¬Ù…Ù„ØŒ Ø§Ù„Ø¹Ù…Ù‚ Ø§Ù„Ø«Ù‚Ø§ÙÙŠ)"
echo "   â€¢ Ø±Ø¤Ù‰ Ø§Ù„ØªØ¹Ù„Ù… Ù…Ø¹ Ø±Ø³ÙˆÙ… Ø¨ÙŠØ§Ù†ÙŠØ© ØªÙØ§Ø¹Ù„ÙŠØ©"
echo "   â€¢ ØªØªØ¨Ø¹ ØªØ·ÙˆØ± Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ Ø¹Ø¨Ø± Ø§Ù„ÙˆÙ‚Øª"
echo "   â€¢ ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„ØªÙƒÙŠÙÙŠ"
echo ""
echo "ðŸ’¡ Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:"
echo "   â€¢ Ø§Ø¨Ø¯Ø£ Ø¨Ø²ÙŠØ§Ø±Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø®ØµÙŠØ© Ù„Ø¶Ø¨Ø· ØªÙØ¶ÙŠÙ„Ø§ØªÙƒ"
echo "   â€¢ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù„ØªØ­Ø³ÙŠÙ† Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆÙ„Ø¯"
echo "   â€¢ Ø±Ø§Ø¬Ø¹ Ø±Ø¤Ù‰ Ø§Ù„ØªØ¹Ù„Ù… Ù„ÙÙ‡Ù… ØªØ·ÙˆØ± Ø£Ø³Ù„ÙˆØ¨Ùƒ"
echo "   â€¢ Ø¬Ø±Ø¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ù„ØªØ¬Ø¯ Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨"
echo ""
echo "ðŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…:"
echo "   python test_personal_style_dashboard.py"
echo ""
echo "âš ï¸  Ù„Ù„Ø¥ÙŠÙ‚Ø§Ù: Ø§Ø¶ØºØ· Ctrl+C"
echo "=================================================="

# ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ Ù„Ù„Ù†Ø¸Ø§Ù…
echo "ðŸ§ª ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ Ù„Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø®ØµÙŠ..."
if command -v python3 &> /dev/null || command -v python &> /dev/null; then
    timeout 30 $PYTHON_CMD test_personal_style_dashboard.py --quick 2>/dev/null || echo "âš ï¸  ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹"
fi

# Ø§Ù†ØªØ¸Ø§Ø± Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
echo "âœ¨ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø²! Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø®ØµÙŠØ© Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù†"
echo "   (Ø§Ø³ØªØ®Ø¯Ù… Ctrl+C Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø¸Ø§Ù…)"

# Ø­Ù„Ù‚Ø© Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
while true; do
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø§ Ø²Ø§Ù„Øª ØªØ¹Ù…Ù„
    if ! ps -p $BACKEND_PID > /dev/null 2>&1; then
        echo "âŒ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ù„ÙÙŠ ØªÙˆÙ‚Ù Ø¨Ø´ÙƒÙ„ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹"
        echo "ðŸ“‹ Ø¢Ø®Ø± Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£:"
        tail -5 logs/backend.log 2>/dev/null || echo "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù…ØªØ§Ø­Ø©"
        cleanup
        exit 1
    fi
    
    if ! ps -p $FRONTEND_PID > /dev/null 2>&1; then
        echo "âŒ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© ØªÙˆÙ‚ÙØª Ø¨Ø´ÙƒÙ„ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹"
        echo "ðŸ“‹ Ø¢Ø®Ø± Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£:"
        tail -5 logs/frontend.log 2>/dev/null || echo "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù…ØªØ§Ø­Ø©"
        cleanup
        exit 1
    fi
    
    sleep 15
done
